<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>流程图 | Era 中文文档</title><meta name="description" content="Eramaker + Emuera + Erabasic 中文文档">
    <link rel="modulepreload" href="/Era-Chinese-Documentation/assets/app.4772d866.js"><link rel="modulepreload" href="/Era-Chinese-Documentation/assets/Flow.html.80c487c4.js"><link rel="modulepreload" href="/Era-Chinese-Documentation/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/Era-Chinese-Documentation/assets/Flow.html.6d20e64c.js">
    <link rel="stylesheet" href="/Era-Chinese-Documentation/assets/style.f278e681.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/Era-Chinese-Documentation/" class=""><!----><span class="site-name">Era 中文文档</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/Era-Chinese-Documentation/guide/Quick_Start" class="nav-link" aria-label="快速开始"><!--[--><!--]--> 快速开始 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/Era-Chinese-Documentation/guide/tutorials/" class="nav-link" aria-label="入门教程"><!--[--><!--]--> 入门教程 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/reference/" class="nav-link" aria-label="参考"><!--[--><!--]--> 参考 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="翻译"><span class="title">翻译</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="翻译"><span class="title">翻译</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/Era-Chinese-Documentation/translation/#eramaker-部分" class="nav-link" aria-label="EraMaker"><!--[--><!--]--> EraMaker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/Era-Chinese-Documentation/translation/#emuera-部分" class="nav-link" aria-label="Emuera"><!--[--><!--]--> Emuera <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/development/" class="nav-link" aria-label="开发"><!--[--><!--]--> 开发 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/ecosystem/" class="nav-link" aria-label="生态"><!--[--><!--]--> 生态 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/contribute/" class="nav-link" aria-label="贡献"><!--[--><!--]--> 贡献 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/Era-Chinese-Documentation/guide/Quick_Start" class="nav-link" aria-label="快速开始"><!--[--><!--]--> 快速开始 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/Era-Chinese-Documentation/guide/tutorials/" class="nav-link" aria-label="入门教程"><!--[--><!--]--> 入门教程 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/reference/" class="nav-link" aria-label="参考"><!--[--><!--]--> 参考 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="翻译"><span class="title">翻译</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="翻译"><span class="title">翻译</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/Era-Chinese-Documentation/translation/#eramaker-部分" class="nav-link" aria-label="EraMaker"><!--[--><!--]--> EraMaker <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/Era-Chinese-Documentation/translation/#emuera-部分" class="nav-link" aria-label="Emuera"><!--[--><!--]--> Emuera <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/development/" class="nav-link" aria-label="开发"><!--[--><!--]--> 开发 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/ecosystem/" class="nav-link" aria-label="生态"><!--[--><!--]--> 生态 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/Era-Chinese-Documentation/contribute/" class="nav-link" aria-label="贡献"><!--[--><!--]--> 贡献 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="流程图" tabindex="-1"><a class="header-anchor" href="#流程图" aria-hidden="true">#</a> 流程图</h1><blockquote><p>翻译自原文档：https://osdn.net/projects/emuera/wiki/flow</p></blockquote><p>流程图是用DiagramDesigner创建的。</p><p>数据文件在<a href="">这里</a>。</p><p>在以下描述中，除非另有说明，否则句子的主语是<code>Emuera.exe</code>。</p><h2 id="title" tabindex="-1"><a class="header-anchor" href="#title" aria-hidden="true">#</a> TITLE</h2><p>在启动和读取<code>ERB</code>后，并在运行<code>BEGIN TITLE</code>后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/title.gif" alt=""></p><p>如果<code>@SYSTEM_TITLE</code>被定义了，它就会被调用，其他的就不做了。</p><p>如果<code>@SYSTEM_TITLE</code>在没有<code>BEGIN</code>或<code>LOADDATA</code>指令的情况下被<code>RETURN</code>，就没有下一个操作要执行，错误终止。</p><p>如果没有定义<code>@SYSTEM_TITLE</code>，就会使用标准的标题程序。</p><p>标准标题屏幕上的文字，如<code>[0]从头开始</code>，可以被改变。</p><p>详见<a href="">_replace.csv</a>。</p><p>如果选择<code>[0]从头开始</code>，首先要做的是初始化数据。</p><p>具体来说，<code>STR</code>和<code>PRINTLV</code>的初始值被设置（与<code>RESETDATA</code>指令相同），<code>ADDCHARA 0</code>，等等。</p><p>接下来，<code>BEGIN FIRST</code>被执行，并过渡到<code>FIRST</code>。</p><p>如果选择了<code>[1]加载和启动</code>，如果定义了，就会调用<code>@TITLE_LOADGAME</code>。</p><p>如果没有定义，就会显示标准加载屏幕。</p><p>这与<code>@LOADGAME</code>所调用的屏幕略有不同。</p><h2 id="first" tabindex="-1"><a class="header-anchor" href="#first" aria-hidden="true">#</a> FIRST</h2><p>当在标题屏幕上选择了<code>[0]从头开始</code>，并且在执行了<code>BEGIN FIRST</code>之后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/first.gif" alt=""></p><p>如果在<code>@EVENTFIRST</code>中没有执行<code>BEGIN</code>指令，就没有下一个要执行的进程，错误结束。</p><h2 id="shop" tabindex="-1"><a class="header-anchor" href="#shop" aria-hidden="true">#</a> SHOP</h2><p>在加载和运行<code>BEGIN SHOP</code>后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/shop.gif" alt=""></p><p>如果在加载后，<code>@EVENTSHOP</code>未被处理。</p><p>在<code>@SHOW_SHOP</code>调用之后，要求输入。如果输入是0-99，则处理购买，否则就调用<code>@USERSHOP</code>。 这个范围可以在<code>_replace.csv</code>中改变。 详见<a href="">_replace.csv</a>。</p><p>请注意，<code>@PRINT_ITEMSHOP</code>指令显示的项目范围是<code>ITEMNAME</code>或<code>ITEMSALES</code>中的元素数，以小者为准（标准是1000）。</p><p>当购买过程被调用时，要确定相应的<code>ITEMSALES</code>是否为非零，或者MONEY是否大于<code>ITEMPRICE</code>。</p><p>如果购买决策失败，则要求再次输入。</p><p>在 Eramaker 中，如果购买失败，用户必须从<code>@SHOW_SHOP</code>重新开始。</p><p>如果购买决策成功，将<code>ITEM</code>编号分配给<code>BOUGHT</code>变量，将<code>ITEM:BOUGHT</code>增加1，并通过<code>ITEMPRICE:BOUGHT</code>减少<code>MONEY</code>。</p><p>呼叫<code>@EVENTBUY</code>，返回<code>@SHOW_SHOP</code>。</p><p>除非在某个地方发出<code>BEGIN</code>指令，否则你永远不会离开<code>SHOP</code>。</p><h2 id="train" tabindex="-1"><a class="header-anchor" href="#train" aria-hidden="true">#</a> TRAIN</h2><p>在执行<code>BEGIN TRAIN</code>后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/train.gif" alt=""></p><p>首先，一些变量会被初始化。</p><p>具体来说，将0分配给<code>ASSIPLAY:0</code>，-1分配给<code>PREVCOM:0</code>，-1分配给<code>NEXTCOM:0</code>。</p><p>此外，<code>TFLAG</code>被设置为0，<code>GOTJUEL</code>、<code>TEQUIP</code>、<code>EX</code>、<code>PALAM</code>和<code>SOURCE</code>的所有字符都被设置为0。</p><p>最后，为所有字符的<code>STAIN:2</code>分配2，为<code>STAIN:3</code>分配1，为<code>STAIN:4</code>分配8，为其他分配0。</p><p>当你离开训练流程时，这些值不会被初始化，所以如果你在商店里保存，这些值会保留在你的保存数据中。</p><p>你可以通过<code>@SAVEINFO</code>或其他方法将角色的<code>GOTJUEL</code>、<code>TEQUIP</code>、<code>EX</code>、<code>PALAM</code>等指定为0来保存保存数据的大小。</p><p>这里不解释<code>NEXTCOM</code>的非负值的行为，因为它有一个严重的错误。</p><p>Emuera的<code>NEXTCOM</code>是为了重现旧代码的行为而实施的，包括上述的缺陷，并不打算用于新的用途。</p><p>关于<code>CALLTRAIN</code>指令，见<a href="">扩展</a>。</p><p>显示调用<code>@SHOW_STATUS</code>后可执行的<code>TRAIN</code>。</p><p>搜索<code>@COM_ABLExx</code>，寻找那些有定义的<code>TRAINNAME</code>。</p><p>搜索范围（图中的<code>MAX_TRAIN</code>）对于Emuera来说是到<code>VariableSize.csv</code>中指定的<code>TRAINNAME</code>范围，对于 Eramaker 来说是到2147483647。</p><p>如果<code>@COM_ABLExx</code>没有被定义或返回非零值，那么它就是可执行的，<code>TRAINNAME</code>被打印出来。</p><p>如果<code>@COM_ABLExx</code>返回0，则不能执行，不显示<code>TRAINNAME</code>。</p><p>在这个时候，它记住了是否可执行。 (这并不意味着<code>@COM_ABLExx</code>在运行时被再次调用）。</p><p>显示<code>TRAINNAME</code>后，调用<code>@SHOW_USERCOM</code>。</p><p>在<code>@SHOW_USERCOM</code>之后，输入前初始化<code>UP</code>、<code>DOWN</code>和<code>LOSEBASE</code>。</p><p>之后，要求输入。</p><p>输入的结果与<code>@COM_ABLExx</code>的结果进行核对，如果该命令是可执行的，则调用相应的<code>@COMxx</code>。</p><p>首先，<code>TRAIN</code>号被分配给<code>SELECTCOM</code>变量，所有字符的<code>NOWEX</code>的所有元素被设置为0。</p><p>接下来，<code>@EVENTCOM</code>被调用，接着是相应的<code>@COM</code>。</p><p>如果<code>@COM</code>返回一个非零值，则调用<code>@SOURCE_CHECK</code>、<code>@EVENTCOMEND</code>并返回<code>@SHOW_STATUS</code>。</p><p>在<code>@SOURCE_CHECK</code>完成后，在调用<code>@EVENTCOMEND</code>前，将所有字符的<code>SOURCE</code>的所有元素设置为0。</p><p>如果在<code>@SOURCE_CHECK</code>之后，<code>@EVENTCOMEND</code>不存在或者在<code>@EVENTCOMEND</code>中没有给出WAIT指令，那么在<code>@SHOW_STATUS</code>之前就会产生一个<code>WAIT</code>。</p><p>如果<code>@COM</code>返回0，则返回到<code>@SHOW_STATUS</code>。</p><p>注意，当<code>UPCHECK</code>指令被执行时，<code>UP</code>和<code>DOWN</code>的值与<code>TARGET</code>的<code>PALAM</code>相加和相减，并且<code>UP</code>和<code>DOWN</code>的值都被分配为0。</p><p>如果输入的结果不是可执行的命令，则调用<code>@USERCOM</code>并返回<code>@SHOW_STATUS</code>。</p><p>除非在某个地方发出<code>BEGIN</code>命令，否则你永远不会离开<code>TRAIN</code>。</p><h2 id="ablup" tabindex="-1"><a class="header-anchor" href="#ablup" aria-hidden="true">#</a> ABLUP</h2><p>在执行了<code>BEGIN ABLUP</code>之后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/ablup.gif" alt=""></p><p>调用<code>@SHOW_JUEL</code>和<code>@SHOW_ABLUP_SELECT</code>来请求输入。</p><p>如果输入的范围是0-99，找到相应的<code>@ABLUP</code>。</p><p>如果定义了相应的<code>@ABLUP</code>，则调用<code>@ABLUP</code>并返回到<code>@SHOW_JUEL</code>。</p><p>如果没有定义，就会再次要求输入。</p><p>在 Eramaker 中，如果没有定义，就从<code>@SHOW_JUEL</code>重新开始。</p><p>如果输入值在0-99范围之外，则调用<code>@USERABLUP</code>并返回<code>@SHOW_JUEL</code>。</p><p>从Emuera 1.705开始，没有办法改变这个范围。</p><p>除非在某处给出<code>BEGIN</code>指令，否则你永远无法从<code>ABLUP</code>中出来。</p><h2 id="aftertrain" tabindex="-1"><a class="header-anchor" href="#aftertrain" aria-hidden="true">#</a> AFTERTRAIN</h2><p>在执行<code>BEGIN AFTERTRAIN</code>后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/aftertrain.gif" alt=""></p><p>如果在<code>@EVENTEND</code>内没有执行<code>BEGIN</code>指令，就没有下一个进程可以执行，错误结束。</p><h2 id="turnend" tabindex="-1"><a class="header-anchor" href="#turnend" aria-hidden="true">#</a> TURNEND</h2><p>在执行了<code>@BEGIN TURNEND</code>之后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/turnend.gif" alt=""></p><p>如果在<code>@EVENTTURNEND</code>内没有执行<code>BEGIN</code>指令，就没有下一个进程可以执行，错误结束。</p><h2 id="loadgame" tabindex="-1"><a class="header-anchor" href="#loadgame" aria-hidden="true">#</a> LOADGAME</h2><p>当执行<code>LOADGAME</code>指令时。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/loadgame.gif" alt=""></p><p><code>BEGIN</code>指令包含<code>RETURN</code>指令，<code>BEGIN</code>下面的语句从不执行，但<code>LOADDATA</code>和<code>SAVEDATA</code>指令与<code>CALL</code>指令一样返回原处。</p><p>然而，当<code>LOAD</code>被执行时，它就会忘记原来的位置并过渡到<code>LOADDATAEND</code>。</p><h2 id="savegame" tabindex="-1"><a class="header-anchor" href="#savegame" aria-hidden="true">#</a> SAVEGAME</h2><p>当<code>@SAVEGAME</code>指令被执行时。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/savegame.gif" alt=""></p><p>调用<code>@SAVEINFO</code>的时机是在实际写完之前。</p><h2 id="loaddataend" tabindex="-1"><a class="header-anchor" href="#loaddataend" aria-hidden="true">#</a> LOADDATAEND</h2><p>在<code>LOADGAME</code>中执行了<code>LOAD</code>后，在执行了<code>LOADDATA</code>指令后。</p><p><img src="https://osdn.net/projects/emuera/wiki/flow/attach/loaddataend1821.gif" alt=""></p><p>当执行<code>LOAD</code>时，所有以前的状态，包括被调用的函数，都被擦除。</p><p>Eramaker 在这里什么都不做，就过渡到<code>@SHOW_SHOP</code>。</p><p>在 Emuera 中，如果<code>@SYSTEM_LOADEND</code>被定义，<code>@SYSTEM_LOADEND</code>将被执行。</p><p>如果<code>BEGIN</code>指令在<code>@SYSTEM_LOADEND</code>结束之前被执行，它就会过渡到那里。</p><p>否则，如果定义了<code>@EVENTLOAD</code>，<code>就会执行@EVENTLOAD</code>。</p><p>如果<code>BEGIN</code>指令在<code>@EVENTLOAD</code>结束前被执行，它就会向该方向移动。</p><p>如果<code>BEGIN</code>指令没有被执行，则照常过渡到<code>@SHOW_SHOP</code>。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2021/9/29 上午6:32:30</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: ihex@foxmail.com">Miswanting</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/Era-Chinese-Documentation/assets/app.4772d866.js" defer></script>
  </body>
</html>
